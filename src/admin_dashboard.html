<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Dashboard - Water Monitoring</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
      body{padding:24px;font-family:Montserrat,Arial,Helvetica,sans-serif}
      .tank { width:180px;height:180px;margin:8px }
      .tank-title{ text-align:center;margin-top:6px }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <h2>Admin Dashboard</h2>
          <p>View tank water levels. Only authenticated admins can access this page.</p>
        </div>
        <div class="col-md-4 text-right" style="padding-top:18px">
          <span id="userInfo"></span>
          <button id="logoutBtn" class="btn btn-default">Logout</button>
        </div>
      </div>

      <hr/>

      <div id="tanksRow" class="row"></div>

    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="lib/createWaterBall-jquery.js"></script>
    <script src="lib/adminAuth.js"></script>
    <script>
      // protect page
      adminAuth.requireAuth('admin_login.html');
      var user = adminAuth.currentUser();
      if(user) $('#userInfo').text('Signed in: ' + user.username + ' ');

      $('#logoutBtn').on('click', function(){ adminAuth.logout(); window.location.href='admin_login.html'; });

      // load data.json and render tanks
      function renderTanks(data){
        var $row = $('#tanksRow');
        $row.empty();
        data.forEach(function(t){
          var col = $('<div class="col-xs-6 col-sm-4 col-md-3 text-center"></div>');
          var tankDiv = $('<div class="tank" id="tank-'+t.id+'"></div>');
          var title = $('<div class="tank-title">Tank ' + t.id + '<div style="font-weight:700">' + t.value + '%</div></div>');
          col.append(tankDiv).append(title);
          $row.append(col);
          // create water ball
          $('#'+'tank-'+t.id).createWaterBall({ targetRange: parseFloat(t.value), cvs_config: { width:180, height:180 } });
        });
      }

      $.getJSON('data.json').done(function(data){ renderTanks(data); }).fail(function(){ $('#tanksRow').html('<div class="alert alert-warning">Unable to load data.json</div>'); });
    </script>
  </body>
</html>
